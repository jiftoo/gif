import{G as y,a as v,j as p,r as h,h as b,R as x,b as I}from"./vendor.e6b59346.js";const E=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(e){if(e.ep)return;e.ep=!0;const r=t(e);fetch(e.href,r)}};E();async function F(i){const n=await(await(await fetch(i)).blob()).arrayBuffer(),e=new Uint8Array(n),r=new v(e),a=r.frameInfo(0);return new Array(r.numFrames()).fill(0).map((d,l)=>{const u=new ImageData(a.width,a.height);r.decodeAndBlitFrameRGBA(l,u.data);let f=document.createElement("canvas");return f.width=a.width,f.height=a.height,f.getContext("2d").putImageData(u,0,0),[f,r.frameInfo(l).delay]})}async function R(i,s){const t=new Image,n=new Image,e=Promise.all([new Promise(c=>{t.onload=c}),new Promise(c=>{n.onload=c})]);t.src=i,n.src=s,await e;const r=n.width/n.height,a=t.width*(1/r)+1,d=document.createElement("canvas");d.width=t.width,d.height=t.height+a;const l=d.getContext("2d");if(!l)throw Error("No 2d context");let u=null;i.startsWith("data:image/gif")?u=await D(n,t,d,a,l):u=await S(n,t,d,a,l);const f=await fetch("https://www.jiftoo.dev/gifcaptioner",{method:"POST",mode:"cors",body:u});return f.ok?await f.text():null}async function D(i,s,t,n,e){const r=await F(s.src),a=new y({workers:4,quality:10,width:t.width,height:t.height});return r.forEach(([d,l])=>{e.drawImage(i,0,0,t.width,Math.round(n)),e.drawImage(d,0,n-1),a.addFrame(e,{copy:!0,delay:l*10})}),new Promise(d=>{a.on("finished",l=>{d(l)}),a.render()})}async function S(i,s,t,n,e){return e.drawImage(i,0,0,t.width,n),e.drawImage(s,0,n-1),await new Promise(a=>t.toBlob(d=>a(d)))}const o=p.exports.jsx,g=p.exports.jsxs,A=p.exports.Fragment;function C({onImageSelected:i}){const s=({target:t})=>{if(!t.files)return;const n=new FileReader;n.addEventListener("load",()=>i(n.result)),n.readAsDataURL(t.files[0])};return g("label",{id:"drop-area",children:[g("div",{id:"drop-area-caption",onDragOver:t=>t.preventDefault(),onDrop:t=>{t.preventDefault(),s({target:{files:t.dataTransfer.files}})},children:[o("div",{children:"Drop your gif here"}),o("div",{children:"or click to open file"})]}),o("input",{type:"file",accept:"image/jpeg, image/png, image/gif",onChange:s,style:{display:"none"}})]})}var w;(function(i){i[i.EMPTY=0]="EMPTY",i[i.OK=1]="OK",i[i.ERR=2]="ERR"})(w||(w={}));function P({image:i,imageLink:s,imageLinkState:t,onTextChange:n,resetImage:e,saveImage:r}){const[a,d]=h.exports.useState(1),[l,u]=[.25,3].map(c=>c.toFixed(2)),f=((+l+ +u)/2).toFixed(2);return g("div",{id:"edit-area",children:[o("div",{contentEditable:!0,suppressContentEditableWarning:!0,style:{"--caption-font-size":`calc(var(--caption-font-size-initial) * ${a})`},id:"caption",onInput:n,children:"Caption"}),o("img",{id:"image",src:i}),g("div",{id:"controls",children:[o("div",{style:{textAlign:"center"},children:"Font size multiplier"}),o("input",{type:"range",min:l,max:u,step:.01,value:a,onChange:c=>d(+c.target.value)}),g("div",{id:"range-labels",children:[o("div",{children:l}),o("div",{children:f}),o("div",{children:u})]}),g("div",{id:"control-buttons",children:[o("button",{id:"reset-button",onClick:e,children:"Reset"}),o("button",{id:"save-button",onClick:r,children:"Save"})]}),t!==0&&o("div",{id:"result-link",children:s?g(A,{children:["Link to result: ",o("a",{target:"_blank",referrerPolicy:"no-referrer",href:s,children:s})]}):"Error while creating image"})]})]})}function T(){const[i,s]=h.exports.useState(null),[t,n]=h.exports.useState("Caption");h.exports.useState("1");const[e,r]=h.exports.useState(null),[a,d]=h.exports.useState(0),l=i!==null;return o("div",{id:"frame",className:l?"editor":"selector",onDragOver:c=>{c.preventDefault(),c.dataTransfer.types.includes("Files")&&c.currentTarget.classList.add("drag")},onDragLeave:c=>{c.currentTarget.classList.remove("drag")},children:l?o(P,{imageLinkState:a,imageLink:e,image:i,onTextChange:c=>{c.target,console.log(c.target.innerText),n(c.target.innerText);const m=document.getElementById("image");console.log(m.clientWidth,m.clientHeight)},resetImage:()=>(s(null),d(0)),saveImage:()=>{b(document.getElementById("caption"),{logging:!1,scale:3,windowWidth:1e3,windowHeight:565}).then(async c=>{const m=await R(i,c.toDataURL());d(m?1:2),r(m)})}}):o(C,{onImageSelected:s})})}function L(){return o("div",{id:"app",children:o(T,{})})}x.render(o(I.StrictMode,{children:o(L,{})}),document.body);
