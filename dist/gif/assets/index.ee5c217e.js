import{j as w,D as v,G as E,a as R,r as g,h as I,R as D,b as x}from"./vendor.5b9bcd7b.js";const T=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const e of n)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const e={};return n.integrity&&(e.integrity=n.integrity),n.referrerpolicy&&(e.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?e.credentials="include":n.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(n){if(n.ep)return;n.ep=!0;const e=a(n);fetch(n.href,e)}};T();const i=w.exports.jsx,h=w.exports.jsxs,b=w.exports.Fragment;function O(){return i("a",{id:"github-link",target:"_blank",href:"https://github.com/jiftoo/gif/",children:i(v,{size:38})})}async function F(t){const s=await(await(await fetch(t)).blob()).arrayBuffer(),n=new Uint8Array(s),e=new R(n),r=e.frameInfo(0);return new Array(e.numFrames()).fill(0).map((c,l)=>{const u=new ImageData(r.width,r.height);e.decodeAndBlitFrameRGBA(l,u.data);let f=document.createElement("canvas");return f.width=r.width,f.height=r.height,f.getContext("2d").putImageData(u,0,0),[f,e.frameInfo(l).delay]})}async function A(t,o){const a=new Image,s=new Image,n=Promise.all([new Promise(d=>{a.onload=d}),new Promise(d=>{s.onload=d})]);a.src=t,s.src=o,await n;const e=s.width/s.height,r=a.width*(1/e)+1,c=document.createElement("canvas");c.width=a.width,c.height=a.height+r;const l=c.getContext("2d");if(!l)throw Error("No 2d context");let u=null;t.startsWith("data:image/gif")?u=await N(s,a,c,r,l):u=await C(s,a,c,r,l);const f=await fetch("https://jiftoo.dev/gif/backend",{method:"POST",mode:"cors",body:u});return f.ok?await f.text():null}async function N(t,o,a,s,n){const e=await F(o.src),r=new E({workers:2,quality:10,width:a.width,height:a.height});return e.forEach(([c,l])=>{n.drawImage(t,0,0,a.width,Math.round(s)),n.drawImage(c,0,s-1),r.addFrame(n,{copy:!0,delay:l*10})}),new Promise(c=>{r.on("finished",l=>{c(l)}),r.render()})}async function C(t,o,a,s,n){return n.drawImage(t,0,0,a.width,s),n.drawImage(o,0,s-1),await new Promise(r=>a.toBlob(c=>r(c)))}function G(t){let o;try{o=new URL(t)}catch{return!1}return o.protocol==="http:"||o.protocol==="https:"}var p;(function(t){t[t.NONE=0]="NONE",t.INVALID="This doesn't look like a valid url",t.NOT_AN_IMAGE="This url doesn't link to an valid image",t.FORBIDDEN="Forbidden (403)",t.TIMEOUT="Request timeout",t.ERROR="Unknown error while fetching url"})(p||(p={}));function P({onImageSelected:t}){const[o,a]=g.exports.useState(0),s=({target:e})=>{if(!e.files)return;const r=new FileReader;r.addEventListener("load",()=>t(r.result)),r.readAsDataURL(e.files[0])},n=async e=>{var c;let r=0;if(G(e)){const l=await fetch(e,{method:"GET"}).catch(u=>(u.name==="AbortError"?r=p.TIMEOUT:r=p.ERROR,null));if(l!==null)if(l.status===403)r=p.FORBIDDEN;else if(!((c=l.headers.get("Content-Type"))==null?void 0:c.startsWith("image/")))r=p.NOT_AN_IMAGE;else{const u=await l.blob(),f=new FileReader;f.addEventListener("load",()=>t(f.result)),f.readAsDataURL(u)}}else r=p.INVALID;a(r)};return h("label",{htmlFor:"file-select-onclick",id:"drop-area",onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault(),e.dataTransfer.files.length&&e.dataTransfer.files[0].type.startsWith("image/")&&s({target:{files:e.dataTransfer.files}})},children:[h("div",{id:"drop-area-caption",children:[i("div",{children:"Drop your gif here"}),i("div",{children:"or click to open file"}),i("input",{onPaste:e=>{const r=e.clipboardData||window.clipboardData;n(r.getData("text"))},onKeyDown:e=>{e.key==="Enter"&&n(e.currentTarget.value)},id:"gif-url",placeholder:"or paste the url",type:"url"}),o!==0&&i("div",{id:"url-error",children:o})]}),i("input",{id:"file-select-onclick",type:"file",accept:"image/jpeg, image/png, image/gif",onClick:e=>console.log(e.target),onChange:e=>{console.log(e.target),s(e)},style:{display:"none"}})]})}var y;(function(t){t[t.EMPTY=0]="EMPTY",t[t.PROCESSING=1]="PROCESSING",t[t.OK=2]="OK",t[t.ERR=3]="ERR"})(y||(y={}));function k({image:t,imageLink:o,imageLinkState:a,onTextChange:s,resetImage:n,saveImage:e}){const[r,c]=g.exports.useState(1),[l,u]=[.25,3].map(d=>d.toFixed(2)),f=((+l+ +u)/2).toFixed(2);return h("div",{id:"edit-area",children:[i("div",{contentEditable:!0,suppressContentEditableWarning:!0,style:{"--caption-font-size":`calc(var(--caption-font-size-initial) * ${r})`},id:"caption",onInput:s,children:"Caption"}),i("img",{id:"image",src:t}),h("div",{id:"controls",children:[i("div",{style:{textAlign:"center"},children:"Font size multiplier"}),i("input",{type:"range",min:l,max:u,step:.01,value:r,onChange:d=>c(+d.target.value)}),h("div",{id:"range-labels",children:[i("div",{children:l}),i("div",{children:f}),i("div",{children:u})]}),h("div",{id:"control-buttons",children:[i("button",{id:"reset-button",onClick:n,children:"Reset"}),i("button",{id:"save-button",onClick:e,children:"Generate"})]}),a===1&&i("div",{id:"result-link",children:"Creating image..."}),a!==0&&a!==1&&h(b,{children:[i("div",{id:"result-link",children:o?h(b,{children:["Link to result: ",i("a",{target:"_blank",referrerPolicy:"no-referrer",href:o,children:o})]}):"Error while creating image"}),o&&h("div",{id:"ezgif-buttons",children:[i("a",{target:"_blank",rel:"noopener",href:`https://ezgif.com/optimize?url=${o}`,children:"Optimize"}),i("a",{target:"_blank",rel:"noopener",href:`https://ezgif.com/resize?url=${o}`,children:"Resize"})]})]})]})]})}function z(){const[t,o]=g.exports.useState(null),[a,s]=g.exports.useState("Caption");g.exports.useState("1");const[n,e]=g.exports.useState(null),[r,c]=g.exports.useState(0),l=t!==null;return h("div",{id:"frame",className:l?"editor":"selector",onDragOver:d=>{d.preventDefault(),d.dataTransfer.types.includes("Files")&&d.currentTarget.classList.add("drag")},onDragLeave:d=>{d.currentTarget.classList.remove("drag")},onDrop:d=>{d.currentTarget.classList.remove("drag")},children:[l?i(k,{imageLinkState:r,imageLink:n,image:t,onTextChange:d=>{d.target,console.log(d.target.innerText),s(d.target.innerText);const m=document.getElementById("image");console.log(m.clientWidth,m.clientHeight)},resetImage:()=>(o(null),c(0)),saveImage:()=>{c(1),I(document.getElementById("caption"),{logging:!1,scale:3,windowWidth:1e3,windowHeight:565}).then(async d=>{const m=await A(t,d.toDataURL());c(m?2:3),e(m)})}}):i(P,{onImageSelected:o}),i(O,{})]})}function B(){return i("div",{id:"app",children:i(z,{})})}D.render(i(x.StrictMode,{children:i(B,{})}),document.body);
