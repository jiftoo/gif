import{j as ne,D as fe,c as ue,r as V,h as pe,S as ae,R as ve,a as ge}from"./vendor.e09fe1f0.js";const me=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))f(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&f(d)}).observe(document,{childList:!0,subtree:!0});function c(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerpolicy&&(n.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?n.credentials="include":t.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function f(t){if(t.ep)return;t.ep=!0;const n=c(t);fetch(t.href,n)}};me();var Y={LITTERBOX_API_URL:"https://jiftoo.dev/gif/litterbox",CORS_PROXY_URL:"https://jiftoo.dev/gif/cors",DEFAULT_WORKERS:2,GIF_QUALITY:13,CAPTION_FONT_SIZE_MIN:.25,CAPTION_FONT_SIZE_MAX:3};function we(){return function(e){return!!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}(navigator.userAgent||navigator.vendor||window.opera)}const m=ne.exports.jsx,L=ne.exports.jsxs,Q=ne.exports.Fragment;function xe(){return m("a",{id:"github-link",target:"_blank",title:"Github repository",href:"https://github.com/jiftoo/gif/",children:m(fe,{size:38})})}var oe={exports:{}};(function(e,r){(function(c,f){e.exports=f()})(ue,function(){return function(c){function f(n){if(t[n])return t[n].exports;var d=t[n]={exports:{},id:n,loaded:!1};return c[n].call(d.exports,d,d.exports,f),d.loaded=!0,d.exports}var t={};return f.m=c,f.c=t,f.p="",f(0)}([function(c,f,t){var n,d,v=function(o,s){function w(){this.constructor=o}for(var _ in s)p.call(s,_)&&(o[_]=s[_]);return w.prototype=s.prototype,o.prototype=new w,o.__super__=s.prototype,o},p={}.hasOwnProperty,a=[].indexOf||function(o){for(var s=0,w=this.length;s<w;s++)if(s in this&&this[s]===o)return s;return-1};n=t(1).EventEmitter,t(2),d=function(o){function s(i){var h,l,u;this.running=!1,this.options={},this.frames=[],this.groups=new Map,this.freeWorkers=[],this.activeWorkers=[],this.setOptions(i);for(l in w)u=w[l],(h=this.options)[l]==null&&(h[l]=u)}var w,_;return v(s,o),w={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1},_={delay:500,copy:!1},s.prototype.setOption=function(i,h){if(this.options[i]=h,this._canvas!=null&&(i==="width"||i==="height"))return this._canvas[i]=h},s.prototype.setOptions=function(i){var h,l,u;l=[];for(h in i)p.call(i,h)&&(u=i[h],l.push(this.setOption(h,u)));return l},s.prototype.addFrame=function(i,h){var l,u,g;h==null&&(h={}),l={},l.transparent=this.options.transparent;for(g in _)l[g]=h[g]||_[g];if(this.options.width==null&&this.setOption("width",i.width),this.options.height==null&&this.setOption("height",i.height),typeof ImageData!="undefined"&&ImageData!==null&&i instanceof ImageData)l.data=i.data;else if(typeof CanvasRenderingContext2D!="undefined"&&CanvasRenderingContext2D!==null&&i instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext!="undefined"&&WebGLRenderingContext!==null&&i instanceof WebGLRenderingContext)h.copy?l.data=this.getContextData(i):l.context=i;else{if(i.childNodes==null)throw new Error("Invalid image");h.copy?l.data=this.getImageData(i):l.image=i}return u=this.frames.length,u>0&&l.data&&(this.groups.has(l.data)?this.groups.get(l.data).push(u):this.groups.set(l.data,[u])),this.frames.push(l)},s.prototype.render=function(){var i,h,l;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var u,g,x;for(x=[],u=0,g=this.frames.length;0<=g?u<g:u>g;0<=g?++u:--u)x.push(null);return x}.call(this),h=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(i=0,l=h;0<=l?i<l:i>l;0<=l?++i:--i)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},s.prototype.abort=function(){for(var i;i=this.activeWorkers.shift(),i!=null;)this.log("killing active worker"),i.terminate();return this.running=!1,this.emit("abort")},s.prototype.spawnWorkers=function(){var i,h,l;return i=Math.min(this.options.workers,this.frames.length),function(){l=[];for(var u=h=this.freeWorkers.length;h<=i?u<i:u>i;h<=i?u++:u--)l.push(u);return l}.apply(this).forEach(function(u){return function(g){var x;return u.log("spawning worker "+g),x=new Worker(u.options.workerScript),x.onmessage=function(k){return u.activeWorkers.splice(u.activeWorkers.indexOf(x),1),u.freeWorkers.push(x),u.frameFinished(k.data,!1)},u.freeWorkers.push(x)}}(this)),i},s.prototype.frameFinished=function(i,h){var l,u,g,x;if(this.finishedFrames++,h?(l=this.frames.indexOf(i),u=this.groups.get(i.data)[0],this.log("frame "+(l+1)+" is duplicate of "+u+" - "+this.activeWorkers.length+" active"),this.imageParts[l]={indexOfFirstInGroup:u}):(this.log("frame "+(i.index+1)+" finished - "+this.activeWorkers.length+" active"),this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[i.index]=i),this.options.globalPalette===!0&&!h&&(this.options.globalPalette=i.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(g=1,x=this.freeWorkers.length;1<=x?g<x:g>x;1<=x?++g:--g)this.renderNextFrame();return a.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},s.prototype.finishRendering=function(){var i,h,l,u,g,x,k,R,E,b,T,G,D,C,A,N,z,O,F,y;for(z=this.imageParts,g=x=0,b=z.length;x<b;g=++x)h=z[g],h.indexOfFirstInGroup&&(this.imageParts[g]=this.imageParts[h.indexOfFirstInGroup]);for(E=0,O=this.imageParts,k=0,T=O.length;k<T;k++)h=O[k],E+=(h.data.length-1)*h.pageSize+h.cursor;for(E+=h.pageSize-h.cursor,this.log("rendering finished - filesize "+Math.round(E/1e3)+"kb"),i=new Uint8Array(E),A=0,F=this.imageParts,R=0,G=F.length;R<G;R++)for(h=F[R],y=h.data,l=C=0,D=y.length;C<D;l=++C)N=y[l],i.set(N,A),A+=l===h.data.length-1?h.cursor:h.pageSize;return u=new Blob([i],{type:"image/gif"}),this.emit("finished",u,i)},s.prototype.renderNextFrame=function(){var i,h,l,u;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return i=this.frames[this.nextFrame++],h=this.frames.indexOf(i),h>0&&this.groups.has(i.data)&&this.groups.get(i.data)[0]!==h?void setTimeout(function(g){return function(){return g.frameFinished(i,!0)}}(this),0):(u=this.freeWorkers.shift(),l=this.getTask(i),this.log("starting frame "+(l.index+1)+" of "+this.frames.length),this.activeWorkers.push(u),u.postMessage(l))},s.prototype.getContextData=function(i){return i.getImageData(0,0,this.options.width,this.options.height).data},s.prototype.getImageData=function(i){var h;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),h=this._canvas.getContext("2d"),h.setFill=this.options.background,h.fillRect(0,0,this.options.width,this.options.height),h.drawImage(i,0,0),this.getContextData(h)},s.prototype.getTask=function(i){var h,l;if(h=this.frames.indexOf(i),l={index:h,last:h===this.frames.length-1,delay:i.delay,transparent:i.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:!0},i.data!=null)l.data=i.data;else if(i.context!=null)l.data=this.getContextData(i.context);else{if(i.image==null)throw new Error("Invalid frame");l.data=this.getImageData(i.image)}return l},s.prototype.log=function(i){if(this.options.debug)return console.log(i)},s}(n),c.exports=d},function(c,f){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(a){return typeof a=="function"}function d(a){return typeof a=="number"}function v(a){return typeof a=="object"&&a!==null}function p(a){return a===void 0}c.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(a){if(!d(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},t.prototype.emit=function(a){var o,s,w,_,i,h;if(this._events||(this._events={}),a==="error"&&(!this._events.error||v(this._events.error)&&!this._events.error.length)){if(o=arguments[1],o instanceof Error)throw o;var l=new Error('Uncaught, unspecified "error" event. ('+o+")");throw l.context=o,l}if(s=this._events[a],p(s))return!1;if(n(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:_=Array.prototype.slice.call(arguments,1),s.apply(this,_)}else if(v(s))for(_=Array.prototype.slice.call(arguments,1),h=s.slice(),w=h.length,i=0;i<w;i++)h[i].apply(this,_);return!0},t.prototype.addListener=function(a,o){var s;if(!n(o))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,n(o.listener)?o.listener:o),this._events[a]?v(this._events[a])?this._events[a].push(o):this._events[a]=[this._events[a],o]:this._events[a]=o,v(this._events[a])&&!this._events[a].warned&&(s=p(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[a].length>s&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),typeof console.trace=="function"&&console.trace())),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(a,o){function s(){this.removeListener(a,s),w||(w=!0,o.apply(this,arguments))}if(!n(o))throw TypeError("listener must be a function");var w=!1;return s.listener=o,this.on(a,s),this},t.prototype.removeListener=function(a,o){var s,w,_,i;if(!n(o))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(s=this._events[a],_=s.length,w=-1,s===o||n(s.listener)&&s.listener===o)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,o);else if(v(s)){for(i=_;i-- >0;)if(s[i]===o||s[i].listener&&s[i].listener===o){w=i;break}if(w<0)return this;s.length===1?(s.length=0,delete this._events[a]):s.splice(w,1),this._events.removeListener&&this.emit("removeListener",a,o)}return this},t.prototype.removeAllListeners=function(a){var o,s;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[a]&&delete this._events[a],this;if(arguments.length===0){for(o in this._events)o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[a],n(s))this.removeListener(a,s);else if(s)for(;s.length;)this.removeListener(a,s[s.length-1]);return delete this._events[a],this},t.prototype.listeners=function(a){return this._events&&this._events[a]?n(this._events[a])?[this._events[a]]:this._events[a].slice():[]},t.prototype.listenerCount=function(a){if(this._events){var o=this._events[a];if(n(o))return 1;if(o)return o.length}return 0},t.listenerCount=function(a,o){return a.listenerCount(o)}},function(c,f){var t,n,d,v,p;p=navigator.userAgent.toLowerCase(),v=navigator.platform.toLowerCase(),t=p.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],d=t[1]==="ie"&&document.documentMode,n={name:t[1]==="version"?t[3]:t[1],version:d||parseFloat(t[1]==="opera"&&t[4]?t[4]:t[2]),platform:{name:p.match(/ip(?:ad|od|hone)/)?"ios":(p.match(/(?:webos|android)/)||v.match(/mac|win|linux/)||["other"])[0]}},n[n.name]=!0,n[n.name+parseInt(n.version,10)]=!0,n.platform[n.platform.name]=!0,c.exports=n}])})})(oe);var _e=oe.exports,se={},le,ye;function ke(e,r,c,f){var t=0,f=f===void 0?{}:f,n=f.loop===void 0?null:f.loop,d=f.palette===void 0?null:f.palette;if(r<=0||c<=0||r>65535||c>65535)throw new Error("Width/Height invalid.");function v(h){var l=h.length;if(l<2||l>256||l&l-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return l}e[t++]=71,e[t++]=73,e[t++]=70,e[t++]=56,e[t++]=57,e[t++]=97;var p=0,a=0;if(d!==null){for(var o=v(d);o>>=1;)++p;if(o=1<<p,--p,f.background!==void 0){if(a=f.background,a>=o)throw new Error("Background index out of range.");if(a===0)throw new Error("Background index explicitly passed as 0.")}}if(e[t++]=r&255,e[t++]=r>>8&255,e[t++]=c&255,e[t++]=c>>8&255,e[t++]=(d!==null?128:0)|p,e[t++]=a,e[t++]=0,d!==null)for(var s=0,w=d.length;s<w;++s){var _=d[s];e[t++]=_>>16&255,e[t++]=_>>8&255,e[t++]=_&255}if(n!==null){if(n<0||n>65535)throw new Error("Loop count invalid.");e[t++]=33,e[t++]=255,e[t++]=11,e[t++]=78,e[t++]=69,e[t++]=84,e[t++]=83,e[t++]=67,e[t++]=65,e[t++]=80,e[t++]=69,e[t++]=50,e[t++]=46,e[t++]=48,e[t++]=3,e[t++]=1,e[t++]=n&255,e[t++]=n>>8&255,e[t++]=0}var i=!1;this.addFrame=function(h,l,u,g,x,k){if(i===!0&&(--t,i=!1),k=k===void 0?{}:k,h<0||l<0||h>65535||l>65535)throw new Error("x/y invalid.");if(u<=0||g<=0||u>65535||g>65535)throw new Error("Width/Height invalid.");if(x.length<u*g)throw new Error("Not enough pixels for the frame size.");var R=!0,E=k.palette;if(E==null&&(R=!1,E=d),E==null)throw new Error("Must supply either a local or global palette.");for(var b=v(E),T=0;b>>=1;)++T;b=1<<T;var G=k.delay===void 0?0:k.delay,D=k.disposal===void 0?0:k.disposal;if(D<0||D>3)throw new Error("Disposal out of range.");var C=!1,A=0;if(k.transparent!==void 0&&k.transparent!==null&&(C=!0,A=k.transparent,A<0||A>=b))throw new Error("Transparent color index.");if((D!==0||C||G!==0)&&(e[t++]=33,e[t++]=249,e[t++]=4,e[t++]=D<<2|(C===!0?1:0),e[t++]=G&255,e[t++]=G>>8&255,e[t++]=A,e[t++]=0),e[t++]=44,e[t++]=h&255,e[t++]=h>>8&255,e[t++]=l&255,e[t++]=l>>8&255,e[t++]=u&255,e[t++]=u>>8&255,e[t++]=g&255,e[t++]=g>>8&255,e[t++]=R===!0?128|T-1:0,R===!0)for(var N=0,z=E.length;N<z;++N){var O=E[N];e[t++]=O>>16&255,e[t++]=O>>8&255,e[t++]=O&255}return t=Ee(e,t,T<2?2:T,x),t},this.end=function(){return i===!1&&(e[t++]=59,i=!0),t},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(h){e=h},this.getOutputBufferPosition=function(){return t},this.setOutputBufferPosition=function(h){t=h}}function Ee(e,r,c,f){e[r++]=c;var t=r++,n=1<<c,d=n-1,v=n+1,p=v+1,a=c+1,o=0,s=0;function w(R){for(;o>=R;)e[r++]=s&255,s>>=8,o-=8,r===t+256&&(e[t]=255,t=r++)}function _(R){s|=R<<o,o+=a,w(8)}var i=f[0]&d,h={};_(n);for(var l=1,u=f.length;l<u;++l){var g=f[l]&d,x=i<<8|g,k=h[x];if(k===void 0){for(s|=i<<o,o+=a;o>=8;)e[r++]=s&255,s>>=8,o-=8,r===t+256&&(e[t]=255,t=r++);p===4096?(_(n),p=v+1,a=c+1,h={}):(p>=1<<a&&++a,h[x]=p++),i=g}else i=k}return _(i),_(v),w(1),t+1===r?e[t]=0:(e[t]=r-t-1,e[r++]=0),r}function Ie(e){var r=0;if(e[r++]!==71||e[r++]!==73||e[r++]!==70||e[r++]!==56||(e[r++]+1&253)!=56||e[r++]!==97)throw new Error("Invalid GIF 87a/89a header.");var c=e[r++]|e[r++]<<8,f=e[r++]|e[r++]<<8,t=e[r++],n=t>>7,d=t&7,v=1<<d+1;e[r++],e[r++];var p=null,a=null;n&&(p=r,a=v,r+=v*3);var o=!0,s=[],w=0,_=null,i=0,h=null;for(this.width=c,this.height=f;o&&r<e.length;)switch(e[r++]){case 33:switch(e[r++]){case 255:if(e[r]!==11||e[r+1]==78&&e[r+2]==69&&e[r+3]==84&&e[r+4]==83&&e[r+5]==67&&e[r+6]==65&&e[r+7]==80&&e[r+8]==69&&e[r+9]==50&&e[r+10]==46&&e[r+11]==48&&e[r+12]==3&&e[r+13]==1&&e[r+16]==0)r+=14,h=e[r++]|e[r++]<<8,r++;else for(r+=12;;){var l=e[r++];if(!(l>=0))throw Error("Invalid block size");if(l===0)break;r+=l}break;case 249:if(e[r++]!==4||e[r+4]!==0)throw new Error("Invalid graphics extension block.");var u=e[r++];w=e[r++]|e[r++]<<8,_=e[r++],(u&1)==0&&(_=null),i=u>>2&7,r++;break;case 254:for(;;){var l=e[r++];if(!(l>=0))throw Error("Invalid block size");if(l===0)break;r+=l}break;default:throw new Error("Unknown graphic control label: 0x"+e[r-1].toString(16))}break;case 44:var g=e[r++]|e[r++]<<8,x=e[r++]|e[r++]<<8,k=e[r++]|e[r++]<<8,R=e[r++]|e[r++]<<8,E=e[r++],b=E>>7,T=E>>6&1,G=E&7,D=1<<G+1,C=p,A=a,N=!1;if(b){var N=!0;C=r,A=D,r+=D*3}var z=r;for(r++;;){var l=e[r++];if(!(l>=0))throw Error("Invalid block size");if(l===0)break;r+=l}s.push({x:g,y:x,width:k,height:R,has_local_palette:N,palette_offset:C,palette_size:A,data_offset:z,data_length:r-z,transparent_index:_,interlaced:!!T,delay:w,disposal:i});break;case 59:o=!1;break;default:throw new Error("Unknown gif block: 0x"+e[r-1].toString(16))}this.numFrames=function(){return s.length},this.loopCount=function(){return h},this.frameInfo=function(O){if(O<0||O>=s.length)throw new Error("Frame index out of range.");return s[O]},this.decodeAndBlitFrameBGRA=function(O,F){var y=this.frameInfo(O),Z=y.width*y.height,S=new Uint8Array(Z);he(e,y.data_offset,S,Z);var M=y.palette_offset,U=y.transparent_index;U===null&&(U=256);var P=y.width,j=c-P,q=P,H=(y.y*c+y.x)*4,J=((y.y+y.height)*c+y.x)*4,I=H,$=j*4;y.interlaced===!0&&($+=c*4*7);for(var K=8,X=0,ee=S.length;X<ee;++X){var W=S[X];if(q===0&&(I+=$,q=P,I>=J&&($=j*4+c*4*(K-1),I=H+(P+j)*(K<<1),K>>=1)),W===U)I+=4;else{var te=e[M+W*3],re=e[M+W*3+1],ie=e[M+W*3+2];F[I++]=ie,F[I++]=re,F[I++]=te,F[I++]=255}--q}},this.decodeAndBlitFrameRGBA=function(O,F){var y=this.frameInfo(O),Z=y.width*y.height,S=new Uint8Array(Z);he(e,y.data_offset,S,Z);var M=y.palette_offset,U=y.transparent_index;U===null&&(U=256);var P=y.width,j=c-P,q=P,H=(y.y*c+y.x)*4,J=((y.y+y.height)*c+y.x)*4,I=H,$=j*4;y.interlaced===!0&&($+=c*4*7);for(var K=8,X=0,ee=S.length;X<ee;++X){var W=S[X];if(q===0&&(I+=$,q=P,I>=J&&($=j*4+c*4*(K-1),I=H+(P+j)*(K<<1),K>>=1)),W===U)I+=4;else{var te=e[M+W*3],re=e[M+W*3+1],ie=e[M+W*3+2];F[I++]=te,F[I++]=re,F[I++]=ie,F[I++]=255}--q}}}function he(e,r,c,f){for(var t=e[r++],n=1<<t,d=n+1,v=d+1,p=t+1,a=(1<<p)-1,o=0,s=0,w=0,_=e[r++],i=new Int32Array(4096),h=null;;){for(;o<16&&_!==0;)s|=e[r++]<<o,o+=8,_===1?_=e[r++]:--_;if(o<p)break;var l=s&a;if(s>>=p,o-=p,l===n){v=d+1,p=t+1,a=(1<<p)-1,h=null;continue}else if(l===d)break;for(var u=l<v?l:h,g=0,x=u;x>n;)x=i[x]>>8,++g;var k=x,R=w+g+(u!==l?1:0);if(R>f){console.log("Warning, gif stream longer than expected.");return}c[w++]=k,w+=g;var E=w;for(u!==l&&(c[w++]=k),x=u;g--;)x=i[x],c[--E]=x&255,x>>=8;h!==null&&v<4096&&(i[v++]=h<<8|k,v>=a+1&&p<12&&(++p,a=a<<1|1)),h=l}return w!==f&&console.log("Warning, gif stream shorter than expected."),c}try{ye=se.GifWriter=ke,le=se.GifReader=Ie}catch{}async function Re(e){const f=await(await(await fetch(e)).blob()).arrayBuffer(),t=new Uint8Array(f),n=new le(t),d=n.frameInfo(0);return new Array(n.numFrames()).fill(0).map((v,p)=>{const a=new ImageData(d.width,d.height);n.decodeAndBlitFrameRGBA(p,a.data);let o=document.createElement("canvas");return o.width=d.width,o.height=d.height,o.getContext("2d").putImageData(a,0,0),[o,n.frameInfo(p).delay]})}async function Oe(e,r){const c=await fetch(Y.LITTERBOX_API_URL,{method:"POST",mode:"cors",headers:{"image-caption":r.trim()},body:e}).catch(f=>console.error("litterbox failure:",f));return(c==null?void 0:c.ok)?await c.text():null}async function Fe(e,r){const c=new Image,f=new Image,t=Promise.all([new Promise(o=>{c.onload=o}),new Promise(o=>{f.onload=o})]);c.src=e,f.src=r,await t;const n=f.width/f.height,d=c.width*(1/n),v=document.createElement("canvas");v.width=c.width,v.height=c.height+d;const p=v.getContext("2d");if(!p)throw Error("No 2d context");let a=null;return e.startsWith("data:image/gif")?a=await Le(f,c,v,d,p):a=await Ae(f,c,v,d,p),a}async function Le(e,r,c,f,t){const n=await Re(r.src);let d=Y.DEFAULT_WORKERS;de||(d=Math.max(window.navigator.hardwareConcurrency-1,d)),console.log("Using",d,"workers");const v=new _e({workers:d,quality:Y.GIF_QUALITY,width:c.width,height:c.height});return n.forEach(([p,a],o)=>{console.log("Painting gif frames:",o,"/",n.length),t.drawImage(e,0,0,c.width,Math.round(f)),t.drawImage(p,0,f),v.addFrame(t,{copy:!0,delay:a*10})}),new Promise(p=>{v.on("progress",a=>console.log("Building gif:",(a*100).toFixed(1))),v.on("finished",a=>{p(a)}),v.render()})}async function Ae(e,r,c,f,t){return t.drawImage(e,0,0,c.width,f),t.drawImage(r,0,f),await new Promise(d=>c.toBlob(v=>d(v)))}const de=we();function Te(e){let r;try{r=new URL(e)}catch{return!1}return r.protocol==="http:"||r.protocol==="https:"}var B;(function(e){e[e.NONE=0]="NONE",e.INVALID="This doesn't look like a valid url",e.NOT_AN_IMAGE="This url doesn't link to an valid image",e.FORBIDDEN="Forbidden (403)",e.TIMEOUT="Request timeout",e.ERROR="Unknown error while fetching url"})(B||(B={}));function De({onImageSelected:e}){const[r,c]=V.exports.useState(0),f=({target:n})=>{if(!n.files)return;const d=new FileReader;d.addEventListener("load",()=>e(d.result)),d.readAsDataURL(n.files[0])},t=async n=>{var v;let d=0;if(Te(n)){const p=await fetch(`${Y.CORS_PROXY_URL}?url=${n}`,{method:"GET"}).catch(a=>(console.log(`${Y.CORS_PROXY_URL}?url=${n}`),a.name==="AbortError"?d=B.TIMEOUT:d=B.ERROR,null));if(p!==null)if(p.status===ae.FORBIDDEN)d=B.FORBIDDEN;else if(p.status===ae.BAD_REQUEST)d=B.INVALID;else if(p.status===ae.NOT_ACCEPTABLE||!((v=p.headers.get("Content-Type"))==null?void 0:v.startsWith("image")))d=B.NOT_AN_IMAGE;else{const a=await p.blob(),o=new FileReader;o.addEventListener("load",()=>e(o.result)),o.readAsDataURL(a)}}else d=B.INVALID;c(d)};return L("label",{htmlFor:"file-select-onclick",id:"drop-area",onDragOver:n=>{n.preventDefault()},onDrop:n=>{n.preventDefault(),n.dataTransfer.files.length&&n.dataTransfer.files[0].type.startsWith("image/")&&f({target:{files:n.dataTransfer.files}})},children:[L("div",{id:"drop-area-caption",children:[m("div",{children:"Drop your gif here"}),m("div",{children:"or click to open file"}),m("input",{onPaste:n=>{const d=n.clipboardData||window.clipboardData;t(d.getData("text"))},onKeyDown:n=>{n.key==="Enter"&&t(n.currentTarget.value)},id:"gif-url",placeholder:"or paste the url (supports tenor)",type:"url"}),r!==0&&m("div",{id:"url-error",children:r})]}),m("input",{id:"file-select-onclick",type:"file",accept:"image/jpeg, image/png, image/gif",onClick:n=>console.log(n.target),onChange:n=>{console.log(n.target),f(n)},style:{display:"none"}})]})}var ce;(function(e){e[e.EMPTY=0]="EMPTY",e[e.PROCESSING=1]="PROCESSING",e[e.OK=2]="OK",e[e.ERR=3]="ERR",e[e.BACKEND_ERROR=4]="BACKEND_ERROR"})(ce||(ce={}));function Ce({image:e,imageLink:r,imageLinkState:c,onTextChange:f,resetImage:t,saveImage:n}){const[d,v]=[Y.CAPTION_FONT_SIZE_MIN,Y.CAPTION_FONT_SIZE_MAX].map(s=>s.toFixed(2)),p=((+d+ +v)/2).toFixed(2),[a,o]=V.exports.useState(parseFloat(p));return L("div",{id:"edit-area",children:[m("div",{contentEditable:!0,suppressContentEditableWarning:!0,style:{"--caption-font-size":`calc(var(--caption-font-size-initial) * ${a})`},id:"caption",onInput:f,children:"Caption"}),m("img",{id:"image",src:e}),L("div",{id:"controls",children:[m("div",{style:{textAlign:"center"},children:"Font size multiplier"}),m("input",{type:"range",min:d,max:v,step:.01,value:a,onChange:s=>o(+s.currentTarget.value)}),L("div",{id:"range-labels",children:[m("div",{children:d}),m("div",{children:p}),m("div",{children:v})]}),L("div",{id:"control-buttons",children:[m("button",{id:"reset-button",onClick:t,children:"Reset"}),m("button",{id:"save-button",onClick:n,children:"Generate"})]}),c===1&&m("div",{id:"result-link",children:"Generating image..."}),c===4&&m("div",{id:"result-link",children:r?L(Q,{children:[m("span",{children:"Could not upload to litterbox"}),m("br",{}),m("br",{}),"Link to result: ",m("a",{target:"_blank",rel:"noreferrer",href:r,children:r}),m("br",{})]}):"Error creating image"}),c!==0&&c!==1&&c!==4&&L(Q,{children:[m("div",{id:"result-link",children:r?L(Q,{children:["Link to result: ",m("a",{target:"_blank",rel:"noreferrer",href:r,children:r}),m("br",{}),m("small",{children:"(Deleted in 1 hour)"})]}):"Error while creating image"}),r&&L("div",{id:"ezgif-buttons",children:[m("a",{target:"_blank",rel:"noopener",href:`https://ezgif.com/optimize?url=${r}`,children:"Optimize"}),m("a",{target:"_blank",rel:"noopener",href:`https://ezgif.com/resize?url=${r}`,children:"Resize"})]})]})]})]})}function Ne(){const[e,r]=V.exports.useState(null),[c,f]=V.exports.useState(null),[t,n]=V.exports.useState(0),d=e!==null,v=o=>{},p=document.getElementById("caption");return L(Q,{children:[!d&&!de&&m("div",{id:"header-container",children:m("h1",{id:"header",children:"Add text to animated GIF"})}),L("div",{id:"frame",className:d?"editor":"selector",onDragOver:o=>{o.preventDefault(),o.dataTransfer.types.includes("Files")&&o.currentTarget.classList.add("drag")},onDragLeave:o=>{o.currentTarget.classList.remove("drag")},onDrop:o=>{o.currentTarget.classList.remove("drag")},children:[d?m(Ce,{imageLinkState:t,imageLink:c,image:e,onTextChange:v,resetImage:()=>(r(null),n(0)),saveImage:()=>{n(1),pe(p,{logging:!1,scale:3,windowWidth:1e3,windowHeight:565}).then(async o=>{const s=await Fe(e,o.toDataURL()),w=await Oe(s,p.innerText);w?(n(2),f(w)):(n(4),f(URL.createObjectURL(s)))})}}):m(De,{onImageSelected:r}),m(xe,{})]})]})}function Pe(){return m(Q,{children:m(Ne,{})})}ve.render(m(ge.StrictMode,{children:m(Pe,{})}),document.getElementById("app"));
