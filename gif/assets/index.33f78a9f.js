import{j as ne,D as fe,c as ue,r as V,h as pe,S as ae,R as ve,a as ge}from"./vendor.90be4016.js";const me=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))f(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&f(d)}).observe(document,{childList:!0,subtree:!0});function c(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerpolicy&&(a.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?a.credentials="include":t.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function f(t){if(t.ep)return;t.ep=!0;const a=c(t);fetch(t.href,a)}};me();var Y={LITTERBOX_API_URL:"https://jiftoo.dev/gif/litterbox",CORS_PROXY_URL:"https://jiftoo.dev/gif/cors",DEFAULT_WORKERS:2,GIF_QUALITY:13,CAPTION_FONT_SIZE_MIN:.25,CAPTION_FONT_SIZE_MAX:3};function we(){return function(e){return!!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}(navigator.userAgent||navigator.vendor||window.opera)}const m=ne.exports.jsx,L=ne.exports.jsxs,Q=ne.exports.Fragment;function xe(){return m("a",{id:"github-link",target:"_blank",title:"Github repository",href:"https://github.com/jiftoo/gif/",children:m(fe,{size:38})})}var oe={exports:{}};(function(e,r){(function(c,f){e.exports=f()})(ue,function(){return function(c){function f(a){if(t[a])return t[a].exports;var d=t[a]={exports:{},id:a,loaded:!1};return c[a].call(d.exports,d,d.exports,f),d.loaded=!0,d.exports}var t={};return f.m=c,f.c=t,f.p="",f(0)}([function(c,f,t){var a,d,v=function(l,o){function w(){this.constructor=l}for(var _ in o)p.call(o,_)&&(l[_]=o[_]);return w.prototype=o.prototype,l.prototype=new w,l.__super__=o.prototype,l},p={}.hasOwnProperty,i=[].indexOf||function(l){for(var o=0,w=this.length;o<w;o++)if(o in this&&this[o]===l)return o;return-1};a=t(1).EventEmitter,t(2),d=function(l){function o(n){var h,s,u;this.running=!1,this.options={},this.frames=[],this.groups=new Map,this.freeWorkers=[],this.activeWorkers=[],this.setOptions(n);for(s in w)u=w[s],(h=this.options)[s]==null&&(h[s]=u)}var w,_;return v(o,l),w={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1},_={delay:500,copy:!1},o.prototype.setOption=function(n,h){if(this.options[n]=h,this._canvas!=null&&(n==="width"||n==="height"))return this._canvas[n]=h},o.prototype.setOptions=function(n){var h,s,u;s=[];for(h in n)p.call(n,h)&&(u=n[h],s.push(this.setOption(h,u)));return s},o.prototype.addFrame=function(n,h){var s,u,g;h==null&&(h={}),s={},s.transparent=this.options.transparent;for(g in _)s[g]=h[g]||_[g];if(this.options.width==null&&this.setOption("width",n.width),this.options.height==null&&this.setOption("height",n.height),typeof ImageData!="undefined"&&ImageData!==null&&n instanceof ImageData)s.data=n.data;else if(typeof CanvasRenderingContext2D!="undefined"&&CanvasRenderingContext2D!==null&&n instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext!="undefined"&&WebGLRenderingContext!==null&&n instanceof WebGLRenderingContext)h.copy?s.data=this.getContextData(n):s.context=n;else{if(n.childNodes==null)throw new Error("Invalid image");h.copy?s.data=this.getImageData(n):s.image=n}return u=this.frames.length,u>0&&s.data&&(this.groups.has(s.data)?this.groups.get(s.data).push(u):this.groups.set(s.data,[u])),this.frames.push(s)},o.prototype.render=function(){var n,h,s;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var u,g,x;for(x=[],u=0,g=this.frames.length;0<=g?u<g:u>g;0<=g?++u:--u)x.push(null);return x}.call(this),h=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(n=0,s=h;0<=s?n<s:n>s;0<=s?++n:--n)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},o.prototype.abort=function(){for(var n;n=this.activeWorkers.shift(),n!=null;)this.log("killing active worker"),n.terminate();return this.running=!1,this.emit("abort")},o.prototype.spawnWorkers=function(){var n,h,s;return n=Math.min(this.options.workers,this.frames.length),function(){s=[];for(var u=h=this.freeWorkers.length;h<=n?u<n:u>n;h<=n?u++:u--)s.push(u);return s}.apply(this).forEach(function(u){return function(g){var x;return u.log("spawning worker "+g),x=new Worker(u.options.workerScript),x.onmessage=function(k){return u.activeWorkers.splice(u.activeWorkers.indexOf(x),1),u.freeWorkers.push(x),u.frameFinished(k.data,!1)},u.freeWorkers.push(x)}}(this)),n},o.prototype.frameFinished=function(n,h){var s,u,g,x;if(this.finishedFrames++,h?(s=this.frames.indexOf(n),u=this.groups.get(n.data)[0],this.log("frame "+(s+1)+" is duplicate of "+u+" - "+this.activeWorkers.length+" active"),this.imageParts[s]={indexOfFirstInGroup:u}):(this.log("frame "+(n.index+1)+" finished - "+this.activeWorkers.length+" active"),this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[n.index]=n),this.options.globalPalette===!0&&!h&&(this.options.globalPalette=n.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(g=1,x=this.freeWorkers.length;1<=x?g<x:g>x;1<=x?++g:--g)this.renderNextFrame();return i.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},o.prototype.finishRendering=function(){var n,h,s,u,g,x,k,R,E,b,T,G,D,C,A,N,z,O,F,y;for(z=this.imageParts,g=x=0,b=z.length;x<b;g=++x)h=z[g],h.indexOfFirstInGroup&&(this.imageParts[g]=this.imageParts[h.indexOfFirstInGroup]);for(E=0,O=this.imageParts,k=0,T=O.length;k<T;k++)h=O[k],E+=(h.data.length-1)*h.pageSize+h.cursor;for(E+=h.pageSize-h.cursor,this.log("rendering finished - filesize "+Math.round(E/1e3)+"kb"),n=new Uint8Array(E),A=0,F=this.imageParts,R=0,G=F.length;R<G;R++)for(h=F[R],y=h.data,s=C=0,D=y.length;C<D;s=++C)N=y[s],n.set(N,A),A+=s===h.data.length-1?h.cursor:h.pageSize;return u=new Blob([n],{type:"image/gif"}),this.emit("finished",u,n)},o.prototype.renderNextFrame=function(){var n,h,s,u;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return n=this.frames[this.nextFrame++],h=this.frames.indexOf(n),h>0&&this.groups.has(n.data)&&this.groups.get(n.data)[0]!==h?void setTimeout(function(g){return function(){return g.frameFinished(n,!0)}}(this),0):(u=this.freeWorkers.shift(),s=this.getTask(n),this.log("starting frame "+(s.index+1)+" of "+this.frames.length),this.activeWorkers.push(u),u.postMessage(s))},o.prototype.getContextData=function(n){return n.getImageData(0,0,this.options.width,this.options.height).data},o.prototype.getImageData=function(n){var h;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),h=this._canvas.getContext("2d"),h.setFill=this.options.background,h.fillRect(0,0,this.options.width,this.options.height),h.drawImage(n,0,0),this.getContextData(h)},o.prototype.getTask=function(n){var h,s;if(h=this.frames.indexOf(n),s={index:h,last:h===this.frames.length-1,delay:n.delay,transparent:n.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:!0},n.data!=null)s.data=n.data;else if(n.context!=null)s.data=this.getContextData(n.context);else{if(n.image==null)throw new Error("Invalid frame");s.data=this.getImageData(n.image)}return s},o.prototype.log=function(n){if(this.options.debug)return console.log(n)},o}(a),c.exports=d},function(c,f){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(i){return typeof i=="function"}function d(i){return typeof i=="number"}function v(i){return typeof i=="object"&&i!==null}function p(i){return i===void 0}c.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(i){if(!d(i)||i<0||isNaN(i))throw TypeError("n must be a positive number");return this._maxListeners=i,this},t.prototype.emit=function(i){var l,o,w,_,n,h;if(this._events||(this._events={}),i==="error"&&(!this._events.error||v(this._events.error)&&!this._events.error.length)){if(l=arguments[1],l instanceof Error)throw l;var s=new Error('Uncaught, unspecified "error" event. ('+l+")");throw s.context=l,s}if(o=this._events[i],p(o))return!1;if(a(o))switch(arguments.length){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:_=Array.prototype.slice.call(arguments,1),o.apply(this,_)}else if(v(o))for(_=Array.prototype.slice.call(arguments,1),h=o.slice(),w=h.length,n=0;n<w;n++)h[n].apply(this,_);return!0},t.prototype.addListener=function(i,l){var o;if(!a(l))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",i,a(l.listener)?l.listener:l),this._events[i]?v(this._events[i])?this._events[i].push(l):this._events[i]=[this._events[i],l]:this._events[i]=l,v(this._events[i])&&!this._events[i].warned&&(o=p(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[i].length>o&&(this._events[i].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[i].length),typeof console.trace=="function"&&console.trace())),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(i,l){function o(){this.removeListener(i,o),w||(w=!0,l.apply(this,arguments))}if(!a(l))throw TypeError("listener must be a function");var w=!1;return o.listener=l,this.on(i,o),this},t.prototype.removeListener=function(i,l){var o,w,_,n;if(!a(l))throw TypeError("listener must be a function");if(!this._events||!this._events[i])return this;if(o=this._events[i],_=o.length,w=-1,o===l||a(o.listener)&&o.listener===l)delete this._events[i],this._events.removeListener&&this.emit("removeListener",i,l);else if(v(o)){for(n=_;n-- >0;)if(o[n]===l||o[n].listener&&o[n].listener===l){w=n;break}if(w<0)return this;o.length===1?(o.length=0,delete this._events[i]):o.splice(w,1),this._events.removeListener&&this.emit("removeListener",i,l)}return this},t.prototype.removeAllListeners=function(i){var l,o;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[i]&&delete this._events[i],this;if(arguments.length===0){for(l in this._events)l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events={},this}if(o=this._events[i],a(o))this.removeListener(i,o);else if(o)for(;o.length;)this.removeListener(i,o[o.length-1]);return delete this._events[i],this},t.prototype.listeners=function(i){return this._events&&this._events[i]?a(this._events[i])?[this._events[i]]:this._events[i].slice():[]},t.prototype.listenerCount=function(i){if(this._events){var l=this._events[i];if(a(l))return 1;if(l)return l.length}return 0},t.listenerCount=function(i,l){return i.listenerCount(l)}},function(c,f){var t,a,d,v,p;p=navigator.userAgent.toLowerCase(),v=navigator.platform.toLowerCase(),t=p.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],d=t[1]==="ie"&&document.documentMode,a={name:t[1]==="version"?t[3]:t[1],version:d||parseFloat(t[1]==="opera"&&t[4]?t[4]:t[2]),platform:{name:p.match(/ip(?:ad|od|hone)/)?"ios":(p.match(/(?:webos|android)/)||v.match(/mac|win|linux/)||["other"])[0]}},a[a.name]=!0,a[a.name+parseInt(a.version,10)]=!0,a.platform[a.platform.name]=!0,c.exports=a}])})})(oe);var _e=oe.exports,se={},le,ye;function ke(e,r,c,f){var t=0,f=f===void 0?{}:f,a=f.loop===void 0?null:f.loop,d=f.palette===void 0?null:f.palette;if(r<=0||c<=0||r>65535||c>65535)throw new Error("Width/Height invalid.");function v(h){var s=h.length;if(s<2||s>256||s&s-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return s}e[t++]=71,e[t++]=73,e[t++]=70,e[t++]=56,e[t++]=57,e[t++]=97;var p=0,i=0;if(d!==null){for(var l=v(d);l>>=1;)++p;if(l=1<<p,--p,f.background!==void 0){if(i=f.background,i>=l)throw new Error("Background index out of range.");if(i===0)throw new Error("Background index explicitly passed as 0.")}}if(e[t++]=r&255,e[t++]=r>>8&255,e[t++]=c&255,e[t++]=c>>8&255,e[t++]=(d!==null?128:0)|p,e[t++]=i,e[t++]=0,d!==null)for(var o=0,w=d.length;o<w;++o){var _=d[o];e[t++]=_>>16&255,e[t++]=_>>8&255,e[t++]=_&255}if(a!==null){if(a<0||a>65535)throw new Error("Loop count invalid.");e[t++]=33,e[t++]=255,e[t++]=11,e[t++]=78,e[t++]=69,e[t++]=84,e[t++]=83,e[t++]=67,e[t++]=65,e[t++]=80,e[t++]=69,e[t++]=50,e[t++]=46,e[t++]=48,e[t++]=3,e[t++]=1,e[t++]=a&255,e[t++]=a>>8&255,e[t++]=0}var n=!1;this.addFrame=function(h,s,u,g,x,k){if(n===!0&&(--t,n=!1),k=k===void 0?{}:k,h<0||s<0||h>65535||s>65535)throw new Error("x/y invalid.");if(u<=0||g<=0||u>65535||g>65535)throw new Error("Width/Height invalid.");if(x.length<u*g)throw new Error("Not enough pixels for the frame size.");var R=!0,E=k.palette;if(E==null&&(R=!1,E=d),E==null)throw new Error("Must supply either a local or global palette.");for(var b=v(E),T=0;b>>=1;)++T;b=1<<T;var G=k.delay===void 0?0:k.delay,D=k.disposal===void 0?0:k.disposal;if(D<0||D>3)throw new Error("Disposal out of range.");var C=!1,A=0;if(k.transparent!==void 0&&k.transparent!==null&&(C=!0,A=k.transparent,A<0||A>=b))throw new Error("Transparent color index.");if((D!==0||C||G!==0)&&(e[t++]=33,e[t++]=249,e[t++]=4,e[t++]=D<<2|(C===!0?1:0),e[t++]=G&255,e[t++]=G>>8&255,e[t++]=A,e[t++]=0),e[t++]=44,e[t++]=h&255,e[t++]=h>>8&255,e[t++]=s&255,e[t++]=s>>8&255,e[t++]=u&255,e[t++]=u>>8&255,e[t++]=g&255,e[t++]=g>>8&255,e[t++]=R===!0?128|T-1:0,R===!0)for(var N=0,z=E.length;N<z;++N){var O=E[N];e[t++]=O>>16&255,e[t++]=O>>8&255,e[t++]=O&255}return t=Ee(e,t,T<2?2:T,x),t},this.end=function(){return n===!1&&(e[t++]=59,n=!0),t},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(h){e=h},this.getOutputBufferPosition=function(){return t},this.setOutputBufferPosition=function(h){t=h}}function Ee(e,r,c,f){e[r++]=c;var t=r++,a=1<<c,d=a-1,v=a+1,p=v+1,i=c+1,l=0,o=0;function w(R){for(;l>=R;)e[r++]=o&255,o>>=8,l-=8,r===t+256&&(e[t]=255,t=r++)}function _(R){o|=R<<l,l+=i,w(8)}var n=f[0]&d,h={};_(a);for(var s=1,u=f.length;s<u;++s){var g=f[s]&d,x=n<<8|g,k=h[x];if(k===void 0){for(o|=n<<l,l+=i;l>=8;)e[r++]=o&255,o>>=8,l-=8,r===t+256&&(e[t]=255,t=r++);p===4096?(_(a),p=v+1,i=c+1,h={}):(p>=1<<i&&++i,h[x]=p++),n=g}else n=k}return _(n),_(v),w(1),t+1===r?e[t]=0:(e[t]=r-t-1,e[r++]=0),r}function Ie(e){var r=0;if(e[r++]!==71||e[r++]!==73||e[r++]!==70||e[r++]!==56||(e[r++]+1&253)!=56||e[r++]!==97)throw new Error("Invalid GIF 87a/89a header.");var c=e[r++]|e[r++]<<8,f=e[r++]|e[r++]<<8,t=e[r++],a=t>>7,d=t&7,v=1<<d+1;e[r++],e[r++];var p=null,i=null;a&&(p=r,i=v,r+=v*3);var l=!0,o=[],w=0,_=null,n=0,h=null;for(this.width=c,this.height=f;l&&r<e.length;)switch(e[r++]){case 33:switch(e[r++]){case 255:if(e[r]!==11||e[r+1]==78&&e[r+2]==69&&e[r+3]==84&&e[r+4]==83&&e[r+5]==67&&e[r+6]==65&&e[r+7]==80&&e[r+8]==69&&e[r+9]==50&&e[r+10]==46&&e[r+11]==48&&e[r+12]==3&&e[r+13]==1&&e[r+16]==0)r+=14,h=e[r++]|e[r++]<<8,r++;else for(r+=12;;){var s=e[r++];if(!(s>=0))throw Error("Invalid block size");if(s===0)break;r+=s}break;case 249:if(e[r++]!==4||e[r+4]!==0)throw new Error("Invalid graphics extension block.");var u=e[r++];w=e[r++]|e[r++]<<8,_=e[r++],(u&1)==0&&(_=null),n=u>>2&7,r++;break;case 254:for(;;){var s=e[r++];if(!(s>=0))throw Error("Invalid block size");if(s===0)break;r+=s}break;default:throw new Error("Unknown graphic control label: 0x"+e[r-1].toString(16))}break;case 44:var g=e[r++]|e[r++]<<8,x=e[r++]|e[r++]<<8,k=e[r++]|e[r++]<<8,R=e[r++]|e[r++]<<8,E=e[r++],b=E>>7,T=E>>6&1,G=E&7,D=1<<G+1,C=p,A=i,N=!1;if(b){var N=!0;C=r,A=D,r+=D*3}var z=r;for(r++;;){var s=e[r++];if(!(s>=0))throw Error("Invalid block size");if(s===0)break;r+=s}o.push({x:g,y:x,width:k,height:R,has_local_palette:N,palette_offset:C,palette_size:A,data_offset:z,data_length:r-z,transparent_index:_,interlaced:!!T,delay:w,disposal:n});break;case 59:l=!1;break;default:throw new Error("Unknown gif block: 0x"+e[r-1].toString(16))}this.numFrames=function(){return o.length},this.loopCount=function(){return h},this.frameInfo=function(O){if(O<0||O>=o.length)throw new Error("Frame index out of range.");return o[O]},this.decodeAndBlitFrameBGRA=function(O,F){var y=this.frameInfo(O),Z=y.width*y.height,S=new Uint8Array(Z);he(e,y.data_offset,S,Z);var M=y.palette_offset,U=y.transparent_index;U===null&&(U=256);var P=y.width,j=c-P,q=P,H=(y.y*c+y.x)*4,J=((y.y+y.height)*c+y.x)*4,I=H,$=j*4;y.interlaced===!0&&($+=c*4*7);for(var K=8,X=0,ee=S.length;X<ee;++X){var W=S[X];if(q===0&&(I+=$,q=P,I>=J&&($=j*4+c*4*(K-1),I=H+(P+j)*(K<<1),K>>=1)),W===U)I+=4;else{var te=e[M+W*3],re=e[M+W*3+1],ie=e[M+W*3+2];F[I++]=ie,F[I++]=re,F[I++]=te,F[I++]=255}--q}},this.decodeAndBlitFrameRGBA=function(O,F){var y=this.frameInfo(O),Z=y.width*y.height,S=new Uint8Array(Z);he(e,y.data_offset,S,Z);var M=y.palette_offset,U=y.transparent_index;U===null&&(U=256);var P=y.width,j=c-P,q=P,H=(y.y*c+y.x)*4,J=((y.y+y.height)*c+y.x)*4,I=H,$=j*4;y.interlaced===!0&&($+=c*4*7);for(var K=8,X=0,ee=S.length;X<ee;++X){var W=S[X];if(q===0&&(I+=$,q=P,I>=J&&($=j*4+c*4*(K-1),I=H+(P+j)*(K<<1),K>>=1)),W===U)I+=4;else{var te=e[M+W*3],re=e[M+W*3+1],ie=e[M+W*3+2];F[I++]=te,F[I++]=re,F[I++]=ie,F[I++]=255}--q}}}function he(e,r,c,f){for(var t=e[r++],a=1<<t,d=a+1,v=d+1,p=t+1,i=(1<<p)-1,l=0,o=0,w=0,_=e[r++],n=new Int32Array(4096),h=null;;){for(;l<16&&_!==0;)o|=e[r++]<<l,l+=8,_===1?_=e[r++]:--_;if(l<p)break;var s=o&i;if(o>>=p,l-=p,s===a){v=d+1,p=t+1,i=(1<<p)-1,h=null;continue}else if(s===d)break;for(var u=s<v?s:h,g=0,x=u;x>a;)x=n[x]>>8,++g;var k=x,R=w+g+(u!==s?1:0);if(R>f){console.log("Warning, gif stream longer than expected.");return}c[w++]=k,w+=g;var E=w;for(u!==s&&(c[w++]=k),x=u;g--;)x=n[x],c[--E]=x&255,x>>=8;h!==null&&v<4096&&(n[v++]=h<<8|k,v>=i+1&&p<12&&(++p,i=i<<1|1)),h=s}return w!==f&&console.log("Warning, gif stream shorter than expected."),c}try{ye=se.GifWriter=ke,le=se.GifReader=Ie}catch{}async function Re(e){const f=await(await(await fetch(e)).blob()).arrayBuffer(),t=new Uint8Array(f),a=new le(t),d=a.frameInfo(0);return new Array(a.numFrames()).fill(0).map((v,p)=>{const i=new ImageData(d.width,d.height);a.decodeAndBlitFrameRGBA(p,i.data);let l=document.createElement("canvas");return l.width=d.width,l.height=d.height,l.getContext("2d").putImageData(i,0,0),[l,a.frameInfo(p).delay]})}async function Oe(e,r){const c=await fetch(Y.LITTERBOX_API_URL,{method:"POST",mode:"cors",headers:{"image-caption":r.trim()},body:e}).catch(f=>console.error("litterbox failure:",f));return(c==null?void 0:c.ok)?await c.text():null}async function Fe(e,r){const c=new Image,f=new Image,t=Promise.all([new Promise(l=>{c.onload=l}),new Promise(l=>{f.onload=l})]);c.src=e,f.src=r,await t;const a=f.width/f.height,d=c.width*(1/a),v=document.createElement("canvas");v.width=c.width,v.height=c.height+d;const p=v.getContext("2d");if(!p)throw Error("No 2d context");let i=null;return e.startsWith("data:image/gif")?i=await Le(f,c,v,d,p):i=await Ae(f,c,v,d,p),i}async function Le(e,r,c,f,t){const a=await Re(r.src);let d=Y.DEFAULT_WORKERS;de||(d=Math.max(window.navigator.hardwareConcurrency-1,d)),console.log("Using",d,"workers");const v=new _e({workers:d,quality:Y.GIF_QUALITY,width:c.width,height:c.height});return a.forEach(([p,i],l)=>{console.log("Painting gif frames:",l,"/",a.length),t.drawImage(e,0,0,c.width,Math.round(f)),t.drawImage(p,0,f),v.addFrame(t,{copy:!0,delay:i*10})}),new Promise(p=>{v.on("progress",i=>console.log("Building gif:",(i*100).toFixed(1))),v.on("finished",i=>{p(i)}),v.render()})}async function Ae(e,r,c,f,t){return t.drawImage(e,0,0,c.width,f),t.drawImage(r,0,f),await new Promise(d=>c.toBlob(v=>d(v)))}const de=we();function Te(e){let r;try{r=new URL(e)}catch{return!1}return r.protocol==="http:"||r.protocol==="https:"}var B;(function(e){e[e.NONE=0]="NONE",e.INVALID="This doesn't look like a valid url",e.NOT_AN_IMAGE="This url doesn't link to an valid image",e.FORBIDDEN="Forbidden (403)",e.TIMEOUT="Request timeout",e.ERROR="Unknown error while fetching url"})(B||(B={}));function De({onImageSelected:e}){const[r,c]=V.exports.useState(0),f=({target:a})=>{if(!a.files)return;const d=new FileReader;d.addEventListener("load",()=>e(d.result)),d.readAsDataURL(a.files[0])},t=async a=>{var v;let d=0;if(Te(a)){const p=await fetch(`${Y.CORS_PROXY_URL}?url=${a}`,{method:"GET"}).catch(i=>(console.log(`${Y.CORS_PROXY_URL}?url=${a}`),i.name==="AbortError"?d=B.TIMEOUT:d=B.ERROR,null));if(p!==null)if(p.status===ae.FORBIDDEN)d=B.FORBIDDEN;else if(p.status===ae.BAD_REQUEST)d=B.INVALID;else if(p.status===ae.NOT_ACCEPTABLE||!((v=p.headers.get("Content-Type"))==null?void 0:v.startsWith("image")))d=B.NOT_AN_IMAGE;else{const i=await p.blob(),l=new FileReader;l.addEventListener("load",()=>e(l.result)),l.readAsDataURL(i)}}else d=B.INVALID;c(d)};return L("label",{htmlFor:"file-select-onclick",id:"drop-area",onDragOver:a=>{a.preventDefault()},onDrop:a=>{a.preventDefault(),a.dataTransfer.files.length&&a.dataTransfer.files[0].type.startsWith("image/")&&f({target:{files:a.dataTransfer.files}})},children:[L("div",{id:"drop-area-caption",children:[m("div",{children:"Drop your gif here"}),m("div",{children:"or click to open file"}),m("input",{onPaste:a=>{const d=a.clipboardData||window.clipboardData;t(d.getData("text"))},onKeyDown:a=>{a.key==="Enter"&&t(a.currentTarget.value)},id:"gif-url",placeholder:"or paste the url (supports tenor)",type:"url"}),r!==0&&m("div",{id:"url-error",children:r})]}),m("input",{id:"file-select-onclick",type:"file",accept:"image/jpeg, image/png, image/gif",onClick:a=>console.log(a.target),onChange:a=>{console.log(a.target),f(a)},style:{display:"none"}})]})}var ce;(function(e){e[e.EMPTY=0]="EMPTY",e[e.PROCESSING=1]="PROCESSING",e[e.OK=2]="OK",e[e.ERR=3]="ERR",e[e.BACKEND_ERROR=4]="BACKEND_ERROR"})(ce||(ce={}));function Ce({image:e,imageLink:r,imageLinkState:c,onTextChange:f,resetImage:t,saveImage:a}){const[d,v]=[Y.CAPTION_FONT_SIZE_MIN,Y.CAPTION_FONT_SIZE_MAX].map(o=>o.toFixed(2)),p=((+d+ +v)/2).toFixed(2),[i,l]=V.exports.useState(parseFloat(p));return L("div",{id:"edit-area",children:[m("div",{contentEditable:!0,suppressContentEditableWarning:!0,style:{"--caption-font-size":`calc(var(--caption-font-size-initial) * ${i})`},id:"caption",onInput:f,children:"Caption"}),m("img",{id:"image",src:e}),L("div",{id:"controls",children:[m("div",{style:{textAlign:"center"},children:"Font size multiplier"}),m("input",{type:"range",min:d,max:v,step:.01,value:i,onChange:o=>l(+o.currentTarget.value)}),L("div",{id:"range-labels",children:[m("div",{children:d}),m("div",{children:p}),m("div",{children:v})]}),L("div",{id:"control-buttons",children:[m("button",{id:"reset-button",onClick:t,children:"Reset"}),m("button",{id:"save-button",onClick:a,children:"Generate"})]}),c===1&&m("div",{id:"result-link",children:"Generating image..."}),c===4&&m("div",{id:"result-link",children:r?L(Q,{children:[m("span",{children:"Could not upload to litterbox"}),m("br",{}),m("br",{}),"Link to result: ",m("a",{target:"_blank",rel:"noreferrer",href:r,children:r}),m("br",{})]}):"Error creating image"}),c!==0&&c!==1&&c!==4&&L(Q,{children:[m("div",{id:"result-link",children:r?L(Q,{children:["Link to result: ",m("a",{target:"_blank",rel:"noreferrer",href:r,children:r}),m("br",{}),m("small",{children:"(Deleted in 1 hour)"})]}):"Error while creating image"}),r&&L("div",{id:"ezgif-buttons",children:[m("a",{target:"_blank",rel:"noopener",href:`https://ezgif.com/optimize?url=${r}`,children:"Optimize"}),m("a",{target:"_blank",rel:"noopener",href:`https://ezgif.com/resize?url=${r}`,children:"Resize"})]})]})]})]})}function Ne(){const[e,r]=V.exports.useState(null),[c,f]=V.exports.useState(null),[t,a]=V.exports.useState(0),d=e!==null;return L(Q,{children:[!d&&!de&&m("div",{id:"header-container",children:m("h1",{id:"header",children:"Add text to animated GIF"})}),L("div",{id:"frame",className:d?"editor":"selector",onDragOver:i=>{i.preventDefault(),i.dataTransfer.types.includes("Files")&&i.currentTarget.classList.add("drag")},onDragLeave:i=>{i.currentTarget.classList.remove("drag")},onDrop:i=>{i.currentTarget.classList.remove("drag")},children:[d?m(Ce,{imageLinkState:t,imageLink:c,image:e,onTextChange:i=>{},resetImage:()=>(r(null),a(0)),saveImage:()=>{const i=document.getElementById("caption");a(1),pe(i,{logging:!1,scale:3,windowWidth:1e3,windowHeight:565}).then(async l=>{const o=await Fe(e,l.toDataURL()),w=await Oe(o,i.innerText);w?(a(2),f(w)):(a(4),f(URL.createObjectURL(o)))})}}):m(De,{onImageSelected:r}),m(xe,{})]})]})}function Pe(){return m(Q,{children:m(Ne,{})})}ve.render(m(ge.StrictMode,{children:m(Pe,{})}),document.getElementById("app"));
