import{j as w,D as v,G as E,a as R,r as p,h as I,R as D,b as x}from"./vendor.5b9bcd7b.js";const T=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const e of n)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const e={};return n.integrity&&(e.integrity=n.integrity),n.referrerpolicy&&(e.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?e.credentials="include":n.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(n){if(n.ep)return;n.ep=!0;const e=a(n);fetch(n.href,e)}};T();const i=w.exports.jsx,f=w.exports.jsxs,b=w.exports.Fragment;function O(){return i("a",{id:"github-link",target:"_blank",href:"https://github.com/jiftoo/gif/",children:i(v,{size:38})})}async function F(t){const s=await(await(await fetch(t)).blob()).arrayBuffer(),n=new Uint8Array(s),e=new R(n),r=e.frameInfo(0);return new Array(e.numFrames()).fill(0).map((d,l)=>{const u=new ImageData(r.width,r.height);e.decodeAndBlitFrameRGBA(l,u.data);let h=document.createElement("canvas");return h.width=r.width,h.height=r.height,h.getContext("2d").putImageData(u,0,0),[h,e.frameInfo(l).delay]})}async function A(t,o){const a=new Image,s=new Image,n=Promise.all([new Promise(c=>{a.onload=c}),new Promise(c=>{s.onload=c})]);a.src=t,s.src=o,await n;const e=s.width/s.height,r=a.width*(1/e)+1,d=document.createElement("canvas");d.width=a.width,d.height=a.height+r;const l=d.getContext("2d");if(!l)throw Error("No 2d context");let u=null;t.startsWith("data:image/gif")?u=await N(s,a,d,r,l):u=await C(s,a,d,r,l);const h=await fetch("https://jiftoo.dev/gif/backend",{method:"POST",mode:"cors",body:u});return h.ok?await h.text():null}async function N(t,o,a,s,n){const e=await F(o.src),r=new E({workers:2,quality:10,width:a.width,height:a.height});return e.forEach(([d,l])=>{n.drawImage(t,0,0,a.width,Math.round(s)),n.drawImage(d,0,s-1),r.addFrame(n,{copy:!0,delay:l*10})}),new Promise(d=>{r.on("finished",l=>{d(l)}),r.render()})}async function C(t,o,a,s,n){return n.drawImage(t,0,0,a.width,s),n.drawImage(o,0,s-1),await new Promise(r=>a.toBlob(d=>r(d)))}function G(t){let o;try{o=new URL(t)}catch{return!1}return o.protocol==="http:"||o.protocol==="https:"}var g;(function(t){t[t.NONE=0]="NONE",t.INVALID="This doesn't look like a valid url",t.NOT_AN_IMAGE="This url doesn't link to an valid image",t.FORBIDDEN="Forbidden (403)",t.TIMEOUT="Request timeout",t.ERROR="Unknown error while fetching url"})(g||(g={}));function P({onImageSelected:t}){const[o,a]=p.exports.useState(0),s=({target:e})=>{if(!e.files)return;const r=new FileReader;r.addEventListener("load",()=>t(r.result)),r.readAsDataURL(e.files[0])},n=async e=>{var d;let r=0;if(G(e)){const l=await fetch(e,{method:"GET"}).catch(u=>(u.name==="AbortError"?r=g.TIMEOUT:r=g.ERROR,null));if(l!==null)if(l.status===403)r=g.FORBIDDEN;else if(!((d=l.headers.get("Content-Type"))==null?void 0:d.startsWith("image/")))r=g.NOT_AN_IMAGE;else{const u=await l.blob(),h=new FileReader;h.addEventListener("load",()=>t(h.result)),h.readAsDataURL(u)}}else r=g.INVALID;a(r)};return f("label",{id:"drop-area",children:[i("div",{id:"drop-overlay",style:{position:"absolute",top:0,bottom:0,left:0,right:0},onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault(),e.dataTransfer.files.length&&e.dataTransfer.files[0].type.startsWith("image/")&&s({target:{files:e.dataTransfer.files}})}}),f("div",{id:"drop-area-caption",children:[i("div",{children:"Drop your gif here"}),i("div",{children:"or click to open file"}),i("input",{onPaste:e=>{const r=e.clipboardData||window.clipboardData;n(r.getData("text"))},onKeyDown:e=>{e.key==="Enter"&&n(e.currentTarget.value)},id:"gif-url",placeholder:"or paste the url",type:"url"}),o!==0&&i("div",{id:"url-error",children:o})]}),i("input",{type:"file",accept:"image/jpeg, image/png, image/gif",onChange:s,style:{display:"none"}})]})}var y;(function(t){t[t.EMPTY=0]="EMPTY",t[t.PROCESSING=1]="PROCESSING",t[t.OK=2]="OK",t[t.ERR=3]="ERR"})(y||(y={}));function z({image:t,imageLink:o,imageLinkState:a,onTextChange:s,resetImage:n,saveImage:e}){const[r,d]=p.exports.useState(1),[l,u]=[.25,3].map(c=>c.toFixed(2)),h=((+l+ +u)/2).toFixed(2);return f("div",{id:"edit-area",children:[i("div",{contentEditable:!0,suppressContentEditableWarning:!0,style:{"--caption-font-size":`calc(var(--caption-font-size-initial) * ${r})`},id:"caption",onInput:s,children:"Caption"}),i("img",{id:"image",src:t}),f("div",{id:"controls",children:[i("div",{style:{textAlign:"center"},children:"Font size multiplier"}),i("input",{type:"range",min:l,max:u,step:.01,value:r,onChange:c=>d(+c.target.value)}),f("div",{id:"range-labels",children:[i("div",{children:l}),i("div",{children:h}),i("div",{children:u})]}),f("div",{id:"control-buttons",children:[i("button",{id:"reset-button",onClick:n,children:"Reset"}),i("button",{id:"save-button",onClick:e,children:"Generate"})]}),a===1&&i("div",{id:"result-link",children:"Creating image..."}),a!==0&&a!==1&&f(b,{children:[i("div",{id:"result-link",children:o?f(b,{children:["Link to result: ",i("a",{target:"_blank",referrerPolicy:"no-referrer",href:o,children:o})]}):"Error while creating image"}),o&&f("div",{id:"ezgif-buttons",children:[i("a",{target:"_blank",rel:"noopener",href:`https://ezgif.com/optimize?url=${o}`,children:"Optimize"}),i("a",{target:"_blank",rel:"noopener",href:`https://ezgif.com/resize?url=${o}`,children:"Resize"})]})]})]})]})}function B(){const[t,o]=p.exports.useState(null),[a,s]=p.exports.useState("Caption");p.exports.useState("1");const[n,e]=p.exports.useState(null),[r,d]=p.exports.useState(0),l=t!==null;return f("div",{id:"frame",className:l?"editor":"selector",onDragOver:c=>{c.preventDefault(),c.dataTransfer.types.includes("Files")&&c.currentTarget.classList.add("drag")},onDragLeave:c=>{c.currentTarget.classList.remove("drag")},onDrop:c=>{c.currentTarget.classList.remove("drag")},children:[l?i(z,{imageLinkState:r,imageLink:n,image:t,onTextChange:c=>{c.target,console.log(c.target.innerText),s(c.target.innerText);const m=document.getElementById("image");console.log(m.clientWidth,m.clientHeight)},resetImage:()=>(o(null),d(0)),saveImage:()=>{d(1),I(document.getElementById("caption"),{logging:!1,scale:3,windowWidth:1e3,windowHeight:565}).then(async c=>{const m=await A(t,c.toDataURL());d(m?2:3),e(m)})}}):i(P,{onImageSelected:o}),i(O,{})]})}function S(){return i("div",{id:"app",children:i(B,{})})}D.render(i(x.StrictMode,{children:i(S,{})}),document.body);
